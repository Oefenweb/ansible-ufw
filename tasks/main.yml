# tasks file for ufw
---

- include_tasks: prepare.yaml


# see https://askubuntu.com/a/1064533/261010, https://www.spinics.net/lists/netfilter-devel/msg55682.html
- include: fix-dropped-ssh-sessions.yml
  when:
    - kernel_version is version('4.14', '>=')
    - kernel_version is version('5', '<')
  tags:
    - configuration
    - ufw
    - ufw-fix-dropped-ssh-sessions

- include: install.yml
  tags:
    - configuration
    - ufw
    - ufw-install

- include: configure.yml
  tags:
    - configuration
    - ufw
    - ufw-configure

- name: enable ufw
  ufw:
    state: enabled

- name: start and enable service
  service:
    name: ufw
    state: started
    enabled: true
  tags:
    - configuration
    - ufw
    - ufw-start-enable-service
